<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>CVE-2018-2894 Weblogic 任意上传漏洞复现 - Naykcin's Page</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/logo.png"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://47.95.140.43/typora_pic/background.JPG"><div class="post-title"><h1 class="title">CVE-2018-2894 Weblogic 任意上传漏洞复现</h1><ul class="meta"><li><i class="icon icon-author"></i>Naykcin</li><li><i class="icon icon-clock"></i>3 Minutes</li><li><i class="icon icon-calendar"></i>February 3, 2019</li></ul></div></div><div class="article-content" style="max-width:800px"><h2 id="CVE-2018-2894-Weblogic-任意上传漏洞复现"><a href="#CVE-2018-2894-Weblogic-任意上传漏洞复现" class="headerlink" title="CVE-2018-2894 Weblogic 任意上传漏洞复现"></a><center>CVE-2018-2894 Weblogic 任意上传漏洞复现</center></h2><h3 id="📍-漏洞背景"><a href="#📍-漏洞背景" class="headerlink" title="📍 漏洞背景"></a>📍 漏洞背景</h3><p>Weblogic 管理端未授权的两个页面存在任意上传的漏洞，可 getshell 直接获取权限。两个页面分别为 /ws_utc/begin.do，/ws_utc/config.do</p>
<h3 id="📍-影响范围"><a href="#📍-影响范围" class="headerlink" title="📍 影响范围"></a>📍 影响范围</h3><p>Oracle WebLogic Server，版本10.3.6.0，12.1.3.0，12.2.1.2，12.2.1.3。</p>
<h3 id="📍-漏洞复现"><a href="#📍-漏洞复现" class="headerlink" title="📍 漏洞复现"></a>📍 漏洞复现</h3><h4 id="⚙️-前期准备"><a href="#⚙️-前期准备" class="headerlink" title="⚙️ 前期准备"></a>⚙️ 前期准备</h4><p>登录后台页面：<a href="http://172.16.232.211:7001/console，用户名为" target="_blank" rel="noopener">http://172.16.232.211:7001/console，用户名为</a> weblogic，输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose logs | grep password</span><br></pre></td></tr></table></figure>

<p>获取密码。</p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%889.34.36.png" alt="屏幕快照 2019-12-10 上午9.34.36"></p>
<p>由于 Web Service Test Page 在“生产模式”下默认是不开启的，所以利用该漏洞有一定限制，这里先进行一些配置。</p>
<p>登入后台后，选择 base_domain 配置，在「高级」中开启「启用 web 服务测试页」。</p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%889.38.37.png" alt="屏幕快照 2019-12-10 上午9.38.37"></p>
<p>记得点保存。</p>
<h4 id="⚙️-漏洞利用"><a href="#⚙️-漏洞利用" class="headerlink" title="⚙️ 漏洞利用"></a>⚙️ 漏洞利用</h4><p>访问 <a href="http://172.16.232.211:7001/ws_utc/config.do" target="_blank" rel="noopener">http://172.16.232.211:7001/ws_utc/config.do</a> 页面，这个页面是未授权访问的，且存在任意文件上传漏洞。这里设置 Work Home Dir 为 /u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css，该目录是 ws_utc 应用的静态文件 CSS 目录，访问这个目录是不需要权限的。</p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%889.43.35.png" alt="屏幕快照 2019-12-10 上午9.43.35"></p>
<p>然后选择「安全」-「添加」：</p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%889.44.51.png" alt="屏幕快照 2019-12-10 上午9.44.51"></p>
<p>这里需要抓包，截断返回包会收到该上传文件的时间戳：</p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%889.46.17.png" alt="屏幕快照 2019-12-10 上午9.46.17"></p>
<p>然后访问 <a href="http://172.16.232.211:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]：" target="_blank" rel="noopener">http://172.16.232.211:7001/ws_utc/css/config/keystore/[时间戳]_[文件名]：</a></p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%8810.05.01.png" alt="屏幕快照 2019-12-10 上午10.05.01"></p>
<p>访问成功，蚁剑连接：</p>
<p><img src="http://47.95.140.43/tu/CVE-2018-2894/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7%202019-12-10%20%e4%b8%8a%e5%8d%8810.05.20.png" alt="屏幕快照 2019-12-10 上午10.05.20"></p>
<p>即可 getshell。</p>
</div><div class="article-meta" style="max-width:800px"></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="ck6l6ttka0004pkozpokfrxy1" data-title="CVE-2018-2894 Weblogic 任意上传漏洞复现" data-url="http://yoursite.com/2019/02/03/CVE-2018-2894/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2019/03/03/CVE-2012-1823/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2019/01/02/use-hexo/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/NickYan7" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="http://47.95.140.43/tu/721580653348_.pic.jpg" title="wechat" target="_blank"><i class="icon icon-wechat"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2020 Naykcin's Page</p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>