<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="黑客，仅是一种身份。"><meta name="keywords" content="github"><title>CVE-2020-1472 Zero-Logon - Naykcin's Page</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/uploads/earth.png"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/NickYan7"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="/uploads/background3.JPG"><div class="post-title"><h1 class="title">CVE-2020-1472 Zero-Logon</h1><ul class="meta"><li><i class="icon icon-author"></i>Naykcin</li><li><i class="icon icon-clock"></i>2 Minutes</li><li><i class="icon icon-calendar"></i>September 19, 2020</li></ul></div></div><div class="article-content" style="max-width:800px"><h1 id="CVE-2020-1472-Zero-Logon"><a href="#CVE-2020-1472-Zero-Logon" class="headerlink" title="CVE-2020-1472 Zero-Logon"></a>CVE-2020-1472 Zero-Logon</h1><h2 id="Netlogon-Privilege-Escalation"><a href="#Netlogon-Privilege-Escalation" class="headerlink" title="Netlogon Privilege Escalation"></a>Netlogon Privilege Escalation</h2><p>Netlogon 用于用户和机器在域内的网络认证、复制数据库以及域控备份等功能。该协议身份认证采用了 Challenge-Response 机制，其中加密算法是 <code>AES-CFB8</code> ，并且 <code>IV</code> 默认全零，导致了该漏洞的产生。又因为认证次数没有做限制，签名功能客户端默认可选，使得漏洞可被利用。</p>
<p>只要攻击者在内网环境中可以与域控建立 TCP 连接（即使攻击者不是域内的域成员），则能够通过 Netlogon 协议的缺陷将域控机器账户的密码重置为 0，接着则可以无密码登录而窃取域管账号的 Hash。</p>
<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>Python3 需要安装 impacket 依赖。</p>
<h3 id="重置域控机器账户"><a href="#重置域控机器账户" class="headerlink" title="重置域控机器账户"></a>重置域控机器账户</h3><p><img src="//mucfo.cn/2020/09/19/CVE-2020-1472/1.png" alt="1"></p>
<p>将域控机器账户，即 <code>TEST-DC01</code> 的密码重置为 0。要注意的是这里填的是主机名，即 <code>hostname</code> ，而不是域管的 <code>username</code> 。</p>
<h3 id="无密码登录获取域管-Hash"><a href="#无密码登录获取域管-Hash" class="headerlink" title="无密码登录获取域管 Hash"></a>无密码登录获取域管 Hash</h3><p><img src="//mucfo.cn/2020/09/19/CVE-2020-1472/2.png" alt="2"></p>
<p>由于机器账户的密码已经被置空，所以弹出的 <code>PASSWORD</code> 字段直接回车即可。由此窃取域管 <code>hackin</code> 的 Hash。</p>
<h3 id="PTH-攻击连接域控"><a href="#PTH-攻击连接域控" class="headerlink" title="PTH 攻击连接域控"></a>PTH 攻击连接域控</h3><p><img src="//mucfo.cn/2020/09/19/CVE-2020-1472/3.png" alt="3"></p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>在 Linux 机器上测试时注意 <code>$</code> 等字符的转义。</p>
<h3 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h3><p>请勿随意在生产环境进行测试，将域控机器账户重置可能会造成不可逆的后果。</p>
<h3 id="🌍-参考"><a href="#🌍-参考" class="headerlink" title="🌍 参考"></a>🌍 参考</h3><blockquote>
<ul>
<li><a href="https://www.secura.com/blog/zero-logon" target="_blank" rel="noopener">https://www.secura.com/blog/zero-logon</a></li>
<li><a href="https://github.com/dirkjanm/CVE-2020-1472" target="_blank" rel="noopener">https://github.com/dirkjanm/CVE-2020-1472</a></li>
<li><a href="https://github.com/SecuraBV/CVE-2020-1472/" target="_blank" rel="noopener">https://github.com/SecuraBV/CVE-2020-1472/</a></li>
</ul>
</blockquote>
</div><div class="article-meta" style="max-width:800px"></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2020/06/26/ssrf-gopher/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/NickYan7" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="http://47.95.140.43/tu/721580653348_.pic.jpg" title="wechat" target="_blank"><i class="icon icon-wechat"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2022 Naykcin's Page</p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>